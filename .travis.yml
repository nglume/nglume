language: php
php:
 - 5.6

addons:
  postgresql: "9.3"

services:
  - elasticsearch


before_install:
  - sudo apt-get update -qq

install:
  - rm ./api/.env && cp ./api/.travis.env ./api/.env #replace the .env file with a custom travis one

  - travis_retry composer self-update
  - travis_retry composer install --no-interaction --working-dir forum
  - travis_retry composer install --prefer-source --no-interaction --working-dir api
  - travis_retry composer install --prefer-source --no-interaction

before_script:
  # rest of the stuff
  - psql -c 'create database spira;' -U postgres
  - php artisan migrate
  - php artisan serve --port 8008 --host 127.0.0.1 --quiet 2>&1 >/dev/null &

after_script:
  - php ./vendor/bin/coveralls -v
